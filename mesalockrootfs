#!/bin/bash

set -e

workdir=$(pwd)
rootfs=$workdir/rootfs
dockerdir=$workdir/mesalockrootfs-dockerfile
isodir=$workdir/iso
buildroot=$workdir/build

packages=(filesystem \
          glibc \
          ion-shell \
          uutils-coreutils \
          ripgrep \
          fd-find \
          tzdata \
          xi-core \
          xi-tui \
          uutils-findutils \
          tokei \
          brotli \
          micro)

rm -rf $rootfs
mkdir -p $rootfs

echo "[+] mesalockrootfs: installing packages"
for p in ${packages[@]}; do
  tar xkfJ build/out/$p.tar.xz -C rootfs
done

echo "[+] mesalockrootfs: tar and zip rootfs"
tar cfJ $dockerdir/rootfs.tar.xz -C $rootfs .
