#!/bin/bash

set -xe

export MAKEFLAGS=-j$(nproc)

startdir=$(pwd)
buildroot="$startdir/build"
pkgrepo=$(pwd)/packages

prepare() { :; }
build() { :; }
package() { :; }

. $pkgrepo/$1/BUILD

srcdir="$buildroot/src/$pkgname"
builddir="$buildroot/bld/$pkgname"
pkgdir="$buildroot/pkg/$pkgname"
outdir="$buildroot/out"

rm -rf $srcdir $builddir $pkgdir
mkdir -p $srcdir $builddir $pkgdir $outdir

for f in prepare build package; do
  cd $buildroot && $f
done

tar cvfJ $outdir/$pkgname.tar.xz -C $pkgdir .
